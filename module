# exit when any single command failed
set -e

# parse arguments

command=""
directory=""
help="supported commands: update, remove\n sh module (update by default)\n sh module update \n sh module remove path_to_module\n"


if [[ -z $1 ]]
then
 command=update

elif [[ $1 == "update" ]]
then
 command=update

elif [[ $1 == "remove" ]]
then
 command=remove
 
 if [[ -n $2 ]] && [[ -d $2 ]]
 then directory="$2"

 else
  echo "invalid second argument. maybe empty or wrong path. exit 1"
  exit 1
 fi

else
 echo "invalid first argument. exit 1"
 printf "$help"
 exit 1
fi


# process

if [[ $command == "update" ]]
then
 echo "processing update"
 git submodule sync --recursive
 git submodule update --init --recursive

elif [[ $command == "remove" ]]
then
 echo "processing remove $directory"
 git submodule deinit --force "$directory"
 git rm --force "$directory"
 rm -rf ".git/modules/$directory"

else
 echo "something wrong. exit 1"
 exit 1
fi
